<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de compras</title>
    <link rel="stylesheet" href="style.css">
</head>
<header>
    <div class="header">
        <h1>Carrito de Compras WEB 2</h1>
    </div>
</header>
<body>
    <div id="cardContainerCarrito">
    </div>
<script>
    let $contenedorCarrito = document.getElementById("cardContainerCarrito");
    let contenidoEnLocalStorage = JSON.parse(localStorage.getItem("productosCarrito"));  
    //Seccion titulo tuCarrito y cantidad De productos
    let $divComprarProductos = document.createElement("div");
    $divComprarProductos.id = "comprarProductos";
    let $h4TituloTuCarrito = document.createElement("h4");
    $h4TituloTuCarrito.innerHTML = "Tu Carrito";
    let $h5CantidadDeProductos = document.createElement("h5");
    $h5CantidadDeProductos.id = "cantidadDeProductos";
    $h5CantidadDeProductos.innerHTML = "El Carrito está vacío";
    $divComprarProductos.appendChild($h4TituloTuCarrito);
    $divComprarProductos.appendChild($h5CantidadDeProductos); 
    $contenedorCarrito.appendChild($divComprarProductos);
            if(contenidoEnLocalStorage){
                let cantidad = contenidoEnLocalStorage.reduce((acc, elemento) => {
                    let obj = {}
                    if(!acc.find(e => e.titulo === elemento.titulo)){
                        obj.titulo = elemento.titulo;
                        obj.imagen = elemento.imagen;
                        obj.precio = elemento.precio;
                        acc.push(obj)
                    }
                    return acc;
                }, []);
                let objetoConTituloImagenCantidad = cantidad.map(e => {
                    let cantidad = contenidoEnLocalStorage.filter(elemento => elemento.titulo === e.titulo);
                    return {titulo: e.titulo, imagen: e.imagen, precio: e.precio, cantidad: cantidad.length}
                })
                const crearImagen = (elemento, $imagen) => {
                    $imagen.src = elemento.imagen;
                    $imagen.style.width = "100px";
                    $imagen.style.height = "120px";
                    return $imagen;
                }
                const crearTitulo = (elemento, $titulo) => {
                    $titulo.innerHTML = elemento.titulo;
                    $titulo.style.margin = "0px 10px";
                    $titulo.style.width = "460px";
                    return $titulo;
                }
                const crearPrecio = (elemento, $precio) => {
                    $precio.innerHTML = `${elemento.precio.slice(6)}`;
                    $precio.style.margin = "0px 10px"
                    $precio.style.width = "55px"
                    return $precio;
                }
                const crearCantidad = (elemento, $cantidad) => {
                    $cantidad.innerHTML = `cantidad: ${elemento.cantidad}`;
                    $cantidad.style.margin = "0px 10px"
                    $cantidad.style.width = "70px"
                    return $cantidad;
                }
                let totalCompraCarrito = 0;
                const crearTotal = (elemento, $total) => {
                    let total = parseFloat(elemento.precio.slice(8)) * parseInt(elemento.cantidad);
                    $total.style.margin = "0px 10px";
                    $total.innerHTML = `Total: $${total}`;
                    totalCompraCarrito = totalCompraCarrito + total;
                    return $total;
                }
                const crearTotalCompraCarrito = (totalCompraCarrito, $totalCarrito, $divTotalCarrito) => {
                    $totalCarrito.innerHTML = `Total: $${totalCompraCarrito.toFixed(2)}`;
                    $divTotalCarrito.style.display =  "flex";
                    $divTotalCarrito.style.justifyContent = "flex-end";
                    $divTotalCarrito.style.background =  "aliceblue";
                    $divTotalCarrito.style.fontSize = "larger";
                    $divTotalCarrito.style.fontFamily =  "sans-serif";
                    $divTotalCarrito.appendChild($totalCarrito);
                    return $divTotalCarrito;
                }
                
                //Agregamos los productos del carrito en localstorage al DOM
                objetoConTituloImagenCantidad.forEach(elemento => {
                    let $divProductoEnCarrito = document.createElement("div");
                    let $fragmento = document.createDocumentFragment();
                    let $imagen = document.createElement("img");
                    let $titulo = document.createElement("p");
                    let $precio = document.createElement("p");
                    let $cantidad = document.createElement("p");
                    let $total = document.createElement("p");
                    $divProductoEnCarrito.className = "productosEnCarrito";
                    $fragmento.appendChild(crearImagen(elemento, $imagen));
                    $fragmento.appendChild(crearTitulo(elemento, $titulo));
                    $fragmento.appendChild(crearPrecio(elemento, $precio));
                    $fragmento.appendChild(crearCantidad(elemento, $cantidad));
                    $fragmento.appendChild(crearTotal(elemento, $total));
                    $divProductoEnCarrito.appendChild($fragmento);
                    $divComprarProductos.appendChild($divProductoEnCarrito);
                    $contenedorCarrito.appendChild($divComprarProductos);
                })
                document.getElementById("cantidadDeProductos").innerHTML = `${objetoConTituloImagenCantidad.length} productos`;
                let $divBotonComprarYBorrar = document.createElement("div");
                let $botonBorrar = document.createElement("button");
                let $botonComprar = document.createElement("button");
                $botonBorrar.textContent = "Eliminar carrito";
                $botonComprar.textContent = "Comprar";
                $botonBorrar.style.margin = "0px 10px";
                $botonComprar.style.margin = "0px 10px";
                $divBotonComprarYBorrar.id = "botonComprarYBorrar";
                $divBotonComprarYBorrar.appendChild($botonBorrar);
                $divBotonComprarYBorrar.appendChild($botonComprar);
                $contenedorCarrito.appendChild($divBotonComprarYBorrar)
                let $divTotalCarrito = document.createElement("div");
                let $totalCarrito = document.createElement("p");
                $divComprarProductos.appendChild(crearTotalCompraCarrito(totalCompraCarrito, $totalCarrito, $divTotalCarrito));
                $botonBorrar.addEventListener("click", () => {
                    localStorage.removeItem("contadorCarrito");
                    localStorage.removeItem("productosCarrito");
                    location.reload();
                })
            }

    </script>
    </body>
    <footer>
        <ul>
        <li>WEB II</li>
        <li>Ignacio Moyano Guzmán</li>
        <li><a href="https://github.com/nachomoyano04"><img src="github_733609.png" alt="github">GitHub</a></li>
        </ul>    
        </footer>
        </html>